---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Comments from '../../components/Comments.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={`${post.data.title} - Advanced Biomass Consulting`}>
  <article class="container mx-auto px-4 py-12">
    <div class="max-w-4xl mx-auto">
      <header class="mb-8">
        <nav class="mb-6">
          <a href="/blog" class="text-green-600 hover:text-green-800 font-medium">
            ← Back to Articles
          </a>
        </nav>
        
        <h1 class="text-4xl font-bold text-green-800 mb-4">{post.data.title}</h1>
        
        <div class="flex items-center space-x-6 text-gray-600 mb-6">
          <div class="flex items-center">
            <span>By {post.data.author}</span>
          </div>
          <time datetime={post.data.pubDate.toISOString()}>
            {post.data.pubDate.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </time>
        </div>
        
        {post.data.tags && post.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-6">
            {post.data.tags.map((tag) => (
              <span class="bg-green-100 text-green-800 px-3 py-1 rounded-md text-sm">
                {tag}
              </span>
            ))}
          </div>
        )}
        
        {post.data.description && (
          <p class="text-lg text-gray-600 italic">
            {post.data.description}
          </p>
        )}
      </header>

      <div class="prose prose-lg prose-green max-w-none">
        <Content />
      </div>

      <!-- Comments Section -->
      <div class="mt-12 pt-8 border-t border-gray-200">
        <div class="bg-gray-50 rounded-xl p-6 shadow-sm border border-gray-100">
          <h3 class="text-xl font-semibold text-green-800 mb-6 flex items-center gap-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            Comments & Discussion
          </h3>
          <Comments 
            pageId={post.slug} 
            pageTitle={post.data.title}
            pageUrl={`https://v2.advancedbiomass.com/blog/${post.slug}/`}
          />
        </div>
      </div>

      <footer class="mt-12 pt-8 border-t border-gray-200">
        <div class="bg-green-50 rounded-lg p-6">
          <h3 class="text-lg font-semibold text-green-800 mb-2">About the Author</h3>
          <p class="text-gray-600">
            Paul Janzé has more than 30 years experience in engineering design, project management, 
            equipment manufacturing and maintenance, primarily in the forest products and energy industries. 
            He specializes in biomass handling and processing, material flow analysis, and designing 
            novel solutions to complex processing and handling problems.
          </p>
          <p class="text-gray-600 mt-2">
            Contact: <a href="mailto:pjanze@telus.net" class="text-green-600 hover:text-green-800">pjanze@telus.net</a>
          </p>
        </div>
      </footer>
    </div>
  </article>
</BaseLayout>